{% extends 'base.html' %}
{% load static %}

{% block title %}Admin: Add Shows{% endblock %}

{% block content %}

<style>
/* Main Layout */
.admin-dashboard-container {
    display: flex;
    background-color: #141414;
    color: #fff;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

/* Sidebar */
.admin-sidebar {
    width: 250px;
    background-color: #101010;
    padding: 20px 0;
    flex-shrink: 0;
    border-right: 1px solid #222;
    min-height: 100vh;
    transition: width 0.3s ease;
}

.admin-sidebar-header {
    padding: 0 25px 20px 25px;
    border-bottom: 1px solid #222;
}

.admin-sidebar-logo {
    font-size: 1.8rem;
    font-weight: 700;
    color: #e50914;
    text-decoration: none;
}

.admin-profile {
    display: flex;
    align-items: center;
    padding-left: 35px;
    padding-bottom: 20px;
    border-bottom: 1px solid #222;
}

.admin-profile-pic {
    font-size: 2.5rem;
    margin-right: 15px;
    color: #aaa;
}

.admin-username {
    font-size: 1.1rem;
    font-weight: 500;
    color: #eee;
}

/* Sidebar Navigation */
.admin-nav {
    padding-top: 10px;
}

.admin-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.admin-nav-item {
    display: flex;
    align-items: center;
    padding: 15px 25px;
    text-decoration: none;
    color: #aaa;
    font-size: 1rem;
    transition: all 0.2s ease-in-out;
    white-space: nowrap;
    overflow: hidden;
}

.admin-nav-item i {
    margin-right: 15px;
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
    transition: margin 0.3s ease;
}

.admin-nav-item:hover {
    color: #fff;
    background-color: #222;
}

.admin-nav li.active .admin-nav-item {
    background-color: #e50914;
    color: #fff;
    font-weight: 500;
    border-right: 3px solid #fff;
}
 
/* Main Content Area */
.admin-main-content {
    flex-grow: 1;
    padding: 30px 40px;
    overflow-y: auto;
}

.admin-page-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #fff;
    margin-top: 0;
    margin-bottom: 25px;
    padding-bottom: 10px;
    border-bottom: 3px solid #e50914;
    display: inline-block;
}

/* Section Title */
.admin-main-content .section-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: #fff;
    margin-top: 15px;
    margin-bottom: 20px;
}

/* Horizontal Movie List */
.admin-main-content .horizontal-movie-list {
    display: flex;
    overflow-x: auto;
    gap: 20px;
    padding-bottom: 25px;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Custom Scrollbar */
.horizontal-movie-list::-webkit-scrollbar {
    height: 6px;
}
.horizontal-movie-list::-webkit-scrollbar-thumb {
    background-color: #e50914;
    border-radius: 10px;
}
.horizontal-movie-list::-webkit-scrollbar-track {
    background: #222;
}

/* üé¨ Now Playing Movies Card Design */
.movie-card-horizontal {
    position: relative;
    flex: 0 0 180px;
    background-color: #1c1c1c;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #222;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
}

.movie-card-horizontal:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 18px rgba(255, 255, 255, 0.1);
}

.movie-card-horizontal.selected {
    border-color: #e50914;
    box-shadow: 0 0 15px rgba(229, 9, 20, 0.5);
}

.movie-card-horizontal img {
    width: 100%;
    height: 260px;
    object-fit: cover;
    display: block;
    border-radius: 10px 10px 0 0;
}

/* ‚≠ê Rating & Votes Bar (exact like reference image) */
.movie-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    background: rgba(0, 0, 0, 0.75);
    border-radius: 0 0 10px 10px;
    z-index: 2;
    
}

.rating-info {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #e50914; /* red star color */
    font-weight: 600;
    font-size: 0.95rem;
}

.rating-info i {
    color: #e50914;
    font-size: 0.95rem;
}

.votes-info {
    color: #fff;
    font-size: 0.9rem;
    font-weight: 500;
}


/* Movie Info Below Image */
.movie-info-horizontal {
    padding: 10px 12px;
    background-color: #1c1c1c;
}

.movie-info-horizontal h3 {
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    margin: 5px 0;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
}

.movie-info-horizontal small {
    font-size: 0.8rem;
    color: #aaa;
}

/* Add Show Form */
.admin-main-content .show-form {
    background-color: #1f1f1f;
    padding: 25px;
    border-radius: 8px;
    border: 1px solid #222;
    max-width: 600px;
    margin-top: 30px;
}

.admin-main-content .form-group {
    margin-bottom: 20px;
}

.admin-main-content .form-label {
    display: block;
    font-size: 1rem;
    color: #aaa;
    margin-bottom: 8px;
}

.admin-main-content .form-input {
    width: 90%;
    padding: 12px;
    background-color: #333;
    border: 1px solid #555;
    border-radius: 4px;
    color: #fff;
    font-size: 1rem;
}

.admin-main-content .form-input::placeholder {
    color: #777;
}

.admin-main-content .date-time-group {
    display: flex;
    gap: 25px;
}

.admin-main-content .date-time-group .form-group {
    flex: 1;
}

.admin-main-content .submit-btn {
    background-color: #e50914;
    color: #fff;
    padding: 12px 25px;
    border: none;
    border-radius: 4px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
    margin-top: 20px;
}

.admin-main-content .submit-btn:hover {
    background-color: #f6121d;
}

.admin-main-content #selected-movie-title {
    color: #f5c518;
    font-size: 1.2rem;
    margin-bottom: 15px;
}

/* ‚úÖ Responsive Fix (Now scrolls on all screens) */
@media (max-width: 768px) {
    .admin-sidebar {
        width: 80px !important;
        padding: 20px 0 !important;
    }

    .admin-profile {
        display: none !important;
    }

    .admin-sidebar-header {
        display: block !important;
        padding: 0 0 20px 0;
        text-align: center;
    }

    .admin-sidebar-logo {
        font-size: 1.5rem;
    }

    .admin-nav-item .nav-text {
        display: none !important;
    }

    .admin-nav-item {
        justify-content: center !important;
        padding: 20px 0 !important;
    }

    .admin-nav-item i {
        margin-right: 0 !important;
        font-size: 1.5rem !important;
    }

    .admin-nav li.active .admin-nav-item {
        border-right: none !important;
        background-color: #e50914 !important;
    }

    .admin-main-content {
        padding: 20px !important;
    }

    .admin-page-title {
        font-size: 1.5rem !important;
    

    .admin-main-content .horizontal-movie-list {
        display: flex !important;
        overflow-x: auto !important;
        gap: 12px !important;
    }

    .admin-main-content .movie-card-horizontal {
        flex: 0 0 160px !important;
    }

    .admin-main-content .date-time-group {
        flex-direction: column;
        gap: 0;
    }
}

/* For very small screens */
@media (max-width: 480px) {
    .admin-main-content .horizontal-movie-list {
        gap: 10px !important;
    }

    .admin-main-content .movie-card-horizontal {
        flex: 0 0 140px !important;
    }
}
</style>


<div class="admin-dashboard-container">
    <aside class="admin-sidebar">
        <div class="admin-profile">
            <div class="admin-profile-pic">
                <i class="fas fa-user-circle"></i>
            </div>
            <span class="admin-username">{{ request.user.username }}</span>
        </div>
        
        <nav class="admin-nav">
            <ul>
                <li>
                    <a href="{% url 'admin_dashboard' %}" class="admin-nav-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <!-- *** HTML FIX *** Added <span> tag -->
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="active">
                    <a href="{% url 'add_shows' %}" class="admin-nav-item">
                        <i class="fas fa-plus-circle"></i>
                        <!-- *** HTML FIX *** Added <span> tag -->
                        <span class="nav-text">Add Shows</span>
                    </a>
                </li>
                <li>
                   
                      <a href="{% url 'list_shows' %}" class="admin-nav-item">
                        <i class="fas fa-film"></i>
                        <span class="nav-text">List Shows</span>
                    </a>
                </li>
                <li class="">
                    <a href="{% url 'my_bookings' %}" class="admin-nav-item">
                        <i class="fas fa-receipt"></i>
                        <span class="nav-text">List Bookings</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <div class="admin-main-content">
        <h1 class="admin-page-title">Add Shows</h1>

   <h2 class="section-title">Now Playing Movies</h2>
<div class="now-playing-section">
  <div class="horizontal-movie-list">
    {% for movie in now_playing_movies %}
      <div class="movie-card-horizontal" id="movie-{{ movie.id }}" onclick="selectMovie('{{ movie.id }}', '{{ movie.title|escapejs }}')">
        <div class="movie-card-horizontal">
  <img src="{{ movie.detail_poster_url }}" alt="{{ movie.title }}">
  <div class="movie-overlay">
    <div class="rating-info"><i class="fas fa-star"></i> {{ movie.rating }}</div>
    <div class="votes-info">{{ movie.votes }} Votes</div>
  </div>
</div>
        <div class="movie-info-horizontal">
          <h3>{{ movie.title }}</h3>
          <small>{{ movie.release_date|date:"Y-m-d" }}</small>
        </div>
      </div>
    {% empty %}
      <p>No featured movies found.</p>
    {% endfor %}
  </div>
</div>


        <!-- SECTION 2: ADD SHOW TIME FORM --><h2 class="section-title">Add Show Time</h2>
        <div class="show-form">
            <form method="POST" action="{% url 'add_shows' %}">
                {% csrf_token %}
                
                <!-- This hidden input will store the ID of the selected movie --><input type="hidden" name="movie_id" id="selected-movie-id" required>
                
                <h3 id="selected-movie-title">Select a movie from the list above</h3>

                <!-- *** HTML TYPO FIX: Changed class.form-group to class="form-group" *** -->
                <div class="form-group">
                    <label for="price" class="form-label">Show Price</label>
                    <input type="number" name="price" id="price" class="form-input" placeholder="$ Enter show price" step="0.01" required>
                </div>

                <div class="date-time-group">
                    <!-- *** HTML TYPO FIX: Changed class.form-group to class="form-group" *** -->
                    <div class="form-group">
                        <label for="show_date" class="form-label">Select Date</label>
                        <input type="date" name="show_date" id="show_date" class="form-input" required>
                    </div>
                    <!-- *** HTML TYPO FIX: Changed class.form-group to class="form-group" *** -->
                    <div class="form-group">
                        <label for="show_time" class="form-label">Select Time</label>
                        <input type="time" name="show_time" id="show_time" class="form-input" required>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Add Show Time</button>
            </form>
        </div>
    </div>
</div>

<script>
    let currentSelectedMovieId = null;

    function selectMovie(movieId, movieTitle) {
        // Remove 'selected' class from previously selected card
        if (currentSelectedMovieId) {
            const oldCard = document.getElementById('movie-' + currentSelectedMovieId);
            if (oldCard) {
                oldCard.classList.remove('selected');
            }
        }

        // Add 'selected' class to the new card
        const selectedCard = document.getElementById('movie-' + movieId);
        selectedCard.classList.add('selected');

        // Update the hidden input and title
        document.getElementById('selected-movie-id').value = movieId;
        document.getElementById('selected-movie-title').innerText = 'Adding time for: ' + movieTitle;

        // Store the new selected ID
        currentSelectedMovieId = movieId;
    }
</script>


{% endblock %}

